// Generated by CoffeeScript 1.6.3
var Earth, MapCtrl, failureCB, initCB, panToAustralia, panToState, pan_through_array, pan_through_schools, pan_through_states, run_slide_show, schoolsInStates, setUpEarth;

setUpEarth = function() {
  return google.earth.createInstance('map3d', initCB, failureCB);
};

initCB = function(instance) {
  window.ge = instance;
  return ge.getWindow().setVisibility(true);
};

failureCB = function(errorCode) {
  return console.log(errorCode);
};

google.setOnLoadCallback(setUpEarth);

run_slide_show = function(earth) {
  pan_through_states(schoolsInStates);
  return setTimeout(run_slide_show, 1000 * 45);
};

MapCtrl = function($scope) {
  window.earth = new Earth($scope);
  run_slide_show(earth);
  return $scope.getClass = function(school) {
    if (school === $scope.selectedSchool) {
      return "logo-colour";
    } else {
      return "logo-grey";
    }
  };
};

Earth = (function() {
  function Earth(scope) {
    this.scope = scope;
  }

  Earth.prototype.setViewTo = function(location) {
    var lookAt;
    this.scope.title = location.name;
    this.scope.$apply();
    console.log("Hey we're at " + location.name);
    if (location.lat) {
      console.log(location.lat);
      lookAt = ge.getView().copyAsLookAt(ge.ALTITUDE_RELATIVE_TO_GROUND);
      lookAt.setRange(location.range || 564.00);
      lookAt.setLatitude(location.lat);
      lookAt.setLongitude(location.lng);
      ge.getView().setAbstractView(lookAt);
    }
    if (location.logo) {
      this.scope.selectedSchool = location;
      this.scope.$apply();
    }
    if (location.schools) {
      this.scope.schools = location.schools;
      this.scope.$apply();
    }
    if (location.name === "Australia") {
      this.scope.schools = [];
      return this.scope.$apply();
    }
  };

  return Earth;

})();

schoolsInStates = [
  {
    name: "Victoria",
    range: 1133048,
    lng: 144.53876250295943,
    lat: -37.96765428547502,
    schools: [
      {
        name: "Camberwell Grammar",
        logo: "http://catholicschoolsguide.com.au/wp-content/uploads/xavier-college1.jpg",
        lat: -37.8169075,
        lng: 145.0682967
      }, {
        name: "Xavier College",
        logo: "http://catholicschoolsguide.com.au/wp-content/uploads/xavier-college1.jpg",
        lat: -37.812269,
        lng: 145.031685
      }
    ]
  }, {
    name: "Western Australia",
    range: 2000000,
    lat: -27.6728168,
    lng: 121.6283098,
    schools: [
      {
        name: "Mazenod College",
        logo: "http://catholicschoolsguide.com.au/wp-content/uploads/xavier-college1.jpg",
        lat: -32.006682,
        lng: 116.038843
      }, {
        name: "Perth College",
        logo: "http://catholicschoolsguide.com.au/wp-content/uploads/xavier-college1.jpg",
        lat: -31.931425,
        lng: 115.875297
      }
    ]
  }
];

pan_through_array = function(array, callback, timeout) {
  var iterator, length, timer, timerFunction;
  console.log("IMMA LOOP THROUGH DIS ARRAY " + array);
  iterator = 0;
  length = array.length;
  timerFunction = function() {
    callback(array[iterator]);
    if (iterator === length - 1) {
      clearInterval(timer);
    }
    iterator++;
  };
  return timer = setInterval(timerFunction, timeout);
};

pan_through_schools = function(schools) {
  var callback, timeout;
  timeout = 5000;
  callback = function(school) {
    window.earth.setViewTo(school);
  };
  return pan_through_array(schools, callback, timeout);
};

pan_through_states = function(states) {
  var callback, timeout;
  timeout = 20 * 1000;
  callback = function(state) {
    panToState(state);
    return setTimeout(panToAustralia, 15 * 1000);
  };
  return pan_through_array(states, callback, timeout);
};

panToAustralia = function() {
  var australia;
  australia = {
    name: "Australia",
    range: 4700000,
    lng: 135.307,
    lat: -26.91234
  };
  return window.earth.setViewTo(australia);
};

panToState = function(state) {
  window.earth.setViewTo(state);
  pan_through_schools(state.schools);
};
